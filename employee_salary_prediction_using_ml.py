# -*- coding: utf-8 -*-
"""Employee-Salary-Prediction-Using-ML.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1vvqY58KELhDhUK8MyBerpfhLXLX1Dap8
"""

import pandas as pd
from sklearn.model_selection import train_test_split
from sklearn.linear_model import LinearRegression
from sklearn.metrics import mean_squared_error, r2_score
import matplotlib.pyplot as plt # Make sure this cell is executed before plotting

from google.colab import drive
drive.mount('/content/drive')

# Scatter plot for XGBoost model
plt.scatter(y_test, y_pred_xgb, alpha=0.5)
plt.xlabel("Actual Salary")
plt.ylabel("Predicted Salary (XGBoost)")
plt.title("Actual vs Predicted Salary (XGBoost)")
plt.show()

# Scatter plot for KNN model
plt.scatter(y_test, y_pred_knn, alpha=0.5)
plt.xlabel("Actual Salary")
plt.ylabel("Predicted Salary (KNN)")
plt.title("Actual vs Predicted Salary (KNN)")
plt.show()

# Rerun all cells in the notebook to identify errors.
from IPython.display import display, Javascript

def rerun_all_cells():
  display(Javascript('IPython.notebook.execute_all_cells()'))

rerun_all_cells()

# Scatter plot for Random Forest model
plt.scatter(y_test, model.predict(X_test), alpha=0.5)
plt.xlabel("Actual Salary")
plt.ylabel("Predicted Salary (Random Forest)")
plt.title("Actual vs Predicted Salary (Random Forest)")
plt.show()

"""## XGBoost Model

### Subtask:
Implement and evaluate an XGBoost model.
"""

from xgboost import XGBRegressor

xgb_model = XGBRegressor(random_state=42)
xgb_model.fit(X_train, y_train)
y_pred_xgb = xgb_model.predict(X_test)

print("XGBoost R2 Score:", r2_score(y_test, y_pred_xgb))
print("XGBoost Mean Squared Error:", mean_squared_error(y_test, y_pred_xgb))

"""## KNN Model

### Subtask:
Implement and evaluate a KNN model.
"""

from sklearn.neighbors import KNeighborsRegressor

knn_model = KNeighborsRegressor()
knn_model.fit(X_train, y_train)
y_pred_knn = knn_model.predict(X_test)

print("KNN R2 Score:", r2_score(y_test, y_pred_knn))
print("KNN Mean Squared Error:", mean_squared_error(y_test, y_pred_knn))

df = pd.read_csv("Employers_data.csv")
df

df = df.drop(["Employee_ID", "Name"], axis=1)
df

df = pd.read_csv('/content/Employers_data.csv')
df

df_encoded = pd.get_dummies(df, drop_first=True) #converts categorical columns into numerical columns like 0/1
df_encoded

X = df_encoded.drop("Salary", axis=1)
y = df_encoded["Salary"]

X

y

X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=42)

model = LinearRegression()
model.fit(X_train, y_train)

y_pred = model.predict(X_test)

print("R2 Score:", r2_score(y_test, y_pred))
print("Mean Squared Error:", mean_squared_error(y_test, y_pred))

plt.scatter(y_test, y_pred, alpha=0.5)
plt.xlabel("Actual Salary")
plt.ylabel("Predicted Salary")
plt.title("Actual vs Predicted Salary")
plt.show()

from sklearn.ensemble import RandomForestRegressor
model = RandomForestRegressor()
model.fit(X_train, y_train)

import joblib
joblib.dump(model, "salary_model.pkl")

import seaborn as sns

importance = model.feature_importances_
features = X.columns
sns.barplot(x=importance, y=features)
plt.title("Feature Importance")
plt.show()

from sklearn.model_selection import cross_val_score
scores = cross_val_score(model, X, y, cv=5)
print("Average CV Score:", scores.mean())

residuals = y_test - y_pred
sns.histplot(residuals, kde=True)

pip install shap

import shap
X_train = X_train.astype('float64')
X_test = X_test.astype('float64')
explainer = shap.Explainer(model, X_train)
shap_values = explainer(X_test)
shap.plots.beeswarm(shap_values)

print("Minimum:")
print(df.min(numeric_only=True))
print("\nMaximum:")
print(df.max(numeric_only=True))
print("\nRange:")
print(df.max(numeric_only=True) - df.min(numeric_only=True))

print("Mean:")
print(df.mean(numeric_only=True))
print("\nMedian:")
print(df.median(numeric_only=True))
print("\nMode:")
print(df.mode(numeric_only=True))

print("Standard Deviation:")
print(df.std(numeric_only=True))

"""# Task
Analyze the dataset by calculating the mean, mode, median, minimum, maximum, range, and standard deviation. Additionally, generate a histogram, bar chart, pie chart, boxplot, line chart, and scatter plot to visualize the data distribution, category comparisons, proportions, outliers, trends, and relationships between variables.

## Histogram

### Subtask:
Create a histogram to visualize the distribution of a numerical variable.

**Reasoning**:
Generate a histogram for the 'Salary' column to visualize its distribution.
"""

df['Salary'].hist()
plt.title("Distribution of Salary")
plt.xlabel("Salary")
plt.ylabel("Frequency")
plt.show()

"""## Bar chart

### Subtask:
Generate a bar chart to compare categories of a categorical variable.

**Reasoning**:
Select a categorical column, calculate value counts, and create a bar chart to visualize the distribution of categories.
"""

department_counts = df['Department'].value_counts()
plt.figure(figsize=(10, 6))
department_counts.plot(kind='bar')
plt.title("Distribution of Employees Across Departments")
plt.xlabel("Department")
plt.ylabel("Number of Employees")
plt.xticks(rotation=45, ha='right')
plt.tight_layout()
plt.show()

"""## Pie chart

### Subtask:
Create a pie chart to show the proportions of different categories in a categorical variable.

**Reasoning**:
Calculate the value counts for the 'Gender' variable and create a pie chart to visualize the proportions.
"""

gender_counts = df['Gender'].value_counts()
plt.figure(figsize=(8, 8))
plt.pie(gender_counts, labels=gender_counts.index, autopct='%1.1f%%', startangle=140)
plt.title("Proportion of Employees by Gender")
plt.axis('equal')
plt.show()

"""## Boxplot

### Subtask:
Generate a boxplot to identify outliers in a numerical variable.

**Reasoning**:
Generate a boxplot for the 'Salary' column to visualize its distribution and identify potential outliers.
"""

plt.figure(figsize=(8, 6))
sns.boxplot(x=df['Salary'])
plt.title("Boxplot of Salary")
plt.xlabel("Salary")
plt.show()

"""**Reasoning**:
The boxplot for 'Salary' has been generated. Now, generate a boxplot for the 'Age' column to visualize its distribution and identify potential outliers.


"""

plt.figure(figsize=(8, 6))
sns.boxplot(x=df['Age'])
plt.title("Boxplot of Age")
plt.xlabel("Age")
plt.show()

"""## Line chart

### Subtask:
Create a line chart to visualize the trend of a variable over time (if applicable to the dataset).

**Reasoning**:
Check if a time-based variable exists in the dataset.
"""

print(df.info())

"""## Scatter plot

### Subtask:
Generate a scatter plot to explore the relationship between two numerical variables.

**Reasoning**:
Create a scatter plot to visualize the relationship between 'Experience_Years' and 'Salary'.
"""

plt.scatter(df['Experience_Years'], df['Salary'], alpha=0.5)
plt.xlabel("Experience Years")
plt.ylabel("Salary")
plt.title("Salary vs. Experience Years")
plt.show()

"""## Summary:

### Data Analysis Key Findings

*   The distribution of salaries is visualized through a histogram.
*   A bar chart shows the distribution of employees across different departments.
*   A pie chart illustrates the proportion of employees by gender.
*   Boxplots were generated for 'Salary' and 'Age' to help identify potential outliers.
*   A scatter plot was created to visualize the relationship between 'Experience\_Years' and 'Salary'.

### Insights or Next Steps

*   Further investigation into potential outliers in 'Salary' and 'Age' identified by the boxplots could be beneficial.
*   Analyze the relationship observed in the scatter plot between 'Experience\_Years' and 'Salary' to understand the impact of experience on salary.

## Tools Used

* Pandas for data manipulation and analysis.
* Matplotlib and Seaborn for data visualization.
* Scikit-learn for machine learning (splitting data, linear regression, random forest).
* Joblib for saving the trained model.
* Shap for explaining the model's predictions.
"""